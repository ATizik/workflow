



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A library for making composable state machines, and UIs driven by those state machines.">
      
      
      
        <meta name="author" content="Square, Inc.">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/icon-square.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Concepts - Workflow</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#ef5350">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../css/app.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="red" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#concepts" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Workflow" class="md-header-nav__button md-logo">
          
            <img src="../images/icon-square.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Workflow
            </span>
            <span class="md-header-nav__topic">
              
                Concepts
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/square/workflow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Workflow
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Workflow" class="md-nav__button md-logo">
      
        <img src="../images/icon-square.png" width="48" height="48">
      
    </a>
    Workflow
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/square/workflow/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Workflow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../overview/" title="Documentation" class="md-nav__link">
      Documentation
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Concepts
      </label>
    
    <a href="./" title="Concepts" class="md-nav__link md-nav__link--active">
      Concepts
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#workflow-is-cross-platform" title="Workflow is cross-platform" class="md-nav__link">
    Workflow is cross-platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-role-of-a-workflow" title="The Role of a Workflow" class="md-nav__link">
    The Role of a Workflow
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflows-have-state" title="Workflows have state" class="md-nav__link">
    Workflows have state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-produce-an-external-representation-of-their-state-via-rendering" title="Workflows produce an external representation of their state via Rendering" class="md-nav__link">
    Workflows produce an external representation of their state via Rendering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-form-a-hierarchy-they-may-have-children" title="Workflows form a hierarchy (they may have children)" class="md-nav__link">
    Workflows form a hierarchy (they may have children)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-respond-to-ui-events" title="Workflows can respond to UI events" class="md-nav__link">
    Workflows can respond to UI events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-subscribe-to-external-event-sources" title="Workflows can subscribe to external event sources" class="md-nav__link">
    Workflows can subscribe to external event sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-perform-asynchronous-tasks-workers" title="Workflows can perform asynchronous tasks (Workers)" class="md-nav__link">
    Workflows can perform asynchronous tasks (Workers)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-are-advanced-by-actions" title="Workflows are advanced by Actions" class="md-nav__link">
    Workflows are advanced by Actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-emit-output-events-up-the-hierarchy-to-their-parent" title="Workflows can emit output events up the hierarchy to their parent" class="md-nav__link">
    Workflows can emit output events up the hierarchy to their parent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Kotlin
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Kotlin
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      API Reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        API Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin/api/workflow-core/com.squareup.workflow/" title="workflow-core" class="md-nav__link">
      workflow-core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin/api/workflow-runtime/com.squareup.workflow/" title="workflow-runtime" class="md-nav__link">
      workflow-runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin/api/workflow-ui-core/com.squareup.workflow.ui/" title="workflow-ui-core" class="md-nav__link">
      workflow-ui-core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin/api/workflow-ui-android/com.squareup.workflow.ui/" title="workflow-ui-android" class="md-nav__link">
      workflow-ui-android
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin/api/workflow-testing/com.squareup.workflow.testing/" title="workflow-testing" class="md-nav__link">
      workflow-testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kotlin/api/workflow-rx2/com.squareup.workflow.rx2/" title="workflow-rx2" class="md-nav__link">
      workflow-rx2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Swift
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Swift
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../swift/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swift/adding-workflow-to-a-project/" title="Adding Workflow to a project" class="md-nav__link">
      Adding Workflow to a project
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swift/tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swift/building-a-workflow/" title="Building a Workflow" class="md-nav__link">
      Building a Workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swift/building-a-view-controller-from-screen/" title="Building a View Controller from a Screen" class="md-nav__link">
      Building a View Controller from a Screen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../swift/using-a-workflow-for-ui/" title="Using a Workflow to Show UI" class="md-nav__link">
      Using a Workflow to Show UI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CHANGELOG/" title="Change Log ⏏" class="md-nav__link">
      Change Log ⏏
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CONTRIBUTING/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CODE_OF_CONDUCT/" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#workflow-is-cross-platform" title="Workflow is cross-platform" class="md-nav__link">
    Workflow is cross-platform
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-role-of-a-workflow" title="The Role of a Workflow" class="md-nav__link">
    The Role of a Workflow
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#workflows-have-state" title="Workflows have state" class="md-nav__link">
    Workflows have state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-produce-an-external-representation-of-their-state-via-rendering" title="Workflows produce an external representation of their state via Rendering" class="md-nav__link">
    Workflows produce an external representation of their state via Rendering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-form-a-hierarchy-they-may-have-children" title="Workflows form a hierarchy (they may have children)" class="md-nav__link">
    Workflows form a hierarchy (they may have children)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-respond-to-ui-events" title="Workflows can respond to UI events" class="md-nav__link">
    Workflows can respond to UI events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-subscribe-to-external-event-sources" title="Workflows can subscribe to external event sources" class="md-nav__link">
    Workflows can subscribe to external event sources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-perform-asynchronous-tasks-workers" title="Workflows can perform asynchronous tasks (Workers)" class="md-nav__link">
    Workflows can perform asynchronous tasks (Workers)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-are-advanced-by-actions" title="Workflows are advanced by Actions" class="md-nav__link">
    Workflows are advanced by Actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflows-can-emit-output-events-up-the-hierarchy-to-their-parent" title="Workflows can emit output events up the hierarchy to their parent" class="md-nav__link">
    Workflows can emit output events up the hierarchy to their parent
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/square/workflow/edit/master/docs/concepts.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="concepts">Concepts<a class="headerlink" href="#concepts" title="Permanent link">&para;</a></h1>
<p>Workflows provide a way to build complex applications out of small, isolated pieces with a predictable data flow and a consistent API contract. They are conceptually similar to components in architecture patterns such as React (though they are fully native and type-safe).</p>
<hr />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One important difference between workflows and components found in web frontend frameworks comes from the vast differences between the DOM and native UI paradigms (iOS/Android). The DOM is already declarative (meaning that we can always reason about the element tree in a web page). UIKit, for is not – it very much relies on a procedural programming model where transitions are performed by imperative methods like <code>push</code>, <code>fadeOut</code>, etc. For this reason, workflows do not ever refer directly to views. They are instead responsible for rendering view models. This view model can then be used to update the UI.</p>
</div>
<hr />
<h3 id="workflow-is-cross-platform">Workflow is cross-platform<a class="headerlink" href="#workflow-is-cross-platform" title="Permanent link">&para;</a></h3>
<p>While specific APIs differ between Swift and Kotlin, the Workflow library shares all of the same conceptual pieces on both platforms. This is extremely beneficial when building cross-platform software, as the same design (though not the same code) can be used for both Swift and Kotlin. Build a feature on one platform first? That code now serves as an excellent reference when implementing the same functionality on the other platform.</p>
<h2 id="the-role-of-a-workflow">The Role of a Workflow<a class="headerlink" href="#the-role-of-a-workflow" title="Permanent link">&para;</a></h2>
<p><code>Workflow</code> is a protocol (in Swift) and interface (in Kotlin) that defines the contract for a single node in the workflow hierarchy.</p>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Swift</label>
<div class="superfences-content"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">protocol</span> <span class="nc">Workflow</span><span class="p">:</span> <span class="n">AnyWorkflowConvertible</span> <span class="p">{</span>

    <span class="n">associatedtype</span> <span class="n">State</span>

    <span class="n">associatedtype</span> <span class="n">Output</span> <span class="p">=</span> <span class="n">Never</span>

    <span class="n">associatedtype</span> <span class="n">Rendering</span>

    <span class="kd">func</span> <span class="nf">makeInitialState</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">State</span>

    <span class="kd">func</span> <span class="nf">workflowDidChange</span><span class="p">(</span><span class="n">from</span> <span class="n">previousWorkflow</span><span class="p">:</span> <span class="kc">Self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="kr">inout</span> <span class="n">State</span><span class="p">)</span>

    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="kc">Self</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">Rendering</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">Kotlin</label>
<div class="superfences-content"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">interface</span> <span class="nc">Workflow</span><span class="p">&lt;</span><span class="k">in</span> <span class="n">InputT</span> <span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">StateT</span> <span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="k">out</span> <span class="n">OutputT</span> <span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="k">out</span> <span class="n">RenderingT</span> <span class="p">:</span> <span class="n">Any</span><span class="p">&gt;</span> <span class="p">{</span>

  <span class="k">fun</span> <span class="nf">initialState</span><span class="p">(</span><span class="n">input</span><span class="p">:</span> <span class="n">InputT</span><span class="p">):</span> <span class="n">StateT</span>

  <span class="k">fun</span> <span class="nf">onInputChanged</span><span class="p">(</span>
    <span class="n">old</span><span class="p">:</span> <span class="n">InputT</span><span class="p">,</span>
    <span class="n">new</span><span class="p">:</span> <span class="n">InputT</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">StateT</span>
  <span class="p">):</span> <span class="n">StateT</span> <span class="p">=</span> <span class="n">state</span>

  <span class="k">fun</span> <span class="nf">render</span><span class="p">(</span>
    <span class="n">input</span><span class="p">:</span> <span class="n">InputT</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">StateT</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">RenderContext</span><span class="p">&lt;</span><span class="n">StateT</span><span class="p">,</span> <span class="n">OutputT</span><span class="p">&gt;</span>
  <span class="p">):</span> <span class="n">RenderingT</span>

  <span class="k">fun</span> <span class="nf">snapshotState</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">StateT</span><span class="p">):</span> <span class="n">Snapshot</span>
  <span class="k">fun</span> <span class="nf">restoreState</span><span class="p">(</span><span class="n">snapshot</span><span class="p">:</span> <span class="n">Snapshot</span><span class="p">):</span> <span class="n">StateT</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Workflows have several responsibilities:</p>
<h3 id="workflows-have-state">Workflows have state<a class="headerlink" href="#workflows-have-state" title="Permanent link">&para;</a></h3>
<p>Every Workflow implementation defines a <code>State</code> type to maintain any necessary state while the workflow is running.</p>
<p>For example, a tic-tac-toe game might have a state like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">struct</span> <span class="nc">State</span> <span class="p">{</span>

    <span class="kd">enum</span> <span class="nc">Player</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">x</span>
        <span class="k">case</span> <span class="n">o</span>
    <span class="p">}</span>

    <span class="kd">enum</span> <span class="nc">Space</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">unfilled</span>
        <span class="n">filled</span><span class="p">(</span><span class="n">Player</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// 3 rows * 3 columns = 9 spaces</span>
    <span class="kd">var</span> <span class="nv">spaces</span><span class="p">:</span> <span class="p">[</span><span class="n">Space</span><span class="p">]</span> <span class="p">=</span> <span class="nb">Array</span><span class="p">(</span><span class="n">repeating</span><span class="p">:</span> <span class="p">.</span><span class="n">unfilled</span><span class="p">,</span> <span class="bp">count</span><span class="p">:</span> <span class="mi">9</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nv">currentTurn</span><span class="p">:</span> <span class="n">Player</span> <span class="p">=</span> <span class="p">.</span><span class="n">x</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>When the workflow is first started, it is queried for an initial state value. From that point forward, the workflow may advance to a new state as the result of events occurring from various sources (which will be covered below).</p>
<h3 id="workflows-produce-an-external-representation-of-their-state-via-rendering">Workflows produce an external representation of their state via <code>Rendering</code><a class="headerlink" href="#workflows-produce-an-external-representation-of-their-state-via-rendering" title="Permanent link">&para;</a></h3>
<p>Immediately after starting up, or after a state transition occurs, a workflow will have its <code>render(state:context:)</code> method called. This method is responsible for creating and returning a value of type <code>Rendering</code>. You can think of <code>Rendering</code> as the &ldquo;external state&rdquo; of the workflow. While a workflow&rsquo;s internal state may contain more detailed or comprehensive state, the <code>Rendering</code> (external state) is a type that is useful outside of the workflow.</p>
<p>When building an interactive application, the <code>Rendering</code> type is commonly (but not always) a view model that will drive the UI layer.</p>
<h3 id="workflows-form-a-hierarchy-they-may-have-children">Workflows form a hierarchy (they may have children)<a class="headerlink" href="#workflows-form-a-hierarchy-they-may-have-children" title="Permanent link">&para;</a></h3>
<p>As they produce a <code>Rendering</code> value, it is common for workflows to delegate some portion of that work to a <em>child workflow</em>. This is also done via the <code>RenderContext</code> that is passed into the <code>render</code> method. In order to delegate to a child, the parent workflow instantiates the child within the <code>render</code> method. The parent then calls <code>render</code> on the context, with the child workflow as the single argument. The infrastructure will spin up the child workflow (including initializing its initial state) if this is the first time this child has been used, or, if the child was also used on the previous <code>render</code> pass, the existing child will be updated. Either way, <code>render</code> will ultimately be called on the child (by the Workflow infrastructure), and the resulting <code>Child.Rendering</code> value will be returned to the parent.</p>
<p>This allows a parent to return complex <code>Rendering</code> types (such as a view model representing the entire UI state of an application) without needing to model all of that complexity within a single workflow.</p>
<h3 id="workflows-can-respond-to-ui-events">Workflows can respond to UI events<a class="headerlink" href="#workflows-can-respond-to-ui-events" title="Permanent link">&para;</a></h3>
<p>The <code>RenderContext</code> that is passed into <code>render</code> as the second parameter provides some useful tools to assist in creating the <code>Rendering</code> value.</p>
<p>If a workflow is producing a view model, it is common to need an event handler to respond to UI events. The <code>RenderContext</code> has API to create an event handler that, when called, will advance the workflow by dispatching an action back to the workflow.</p>
<h3 id="workflows-can-subscribe-to-external-event-sources">Workflows can subscribe to external event sources<a class="headerlink" href="#workflows-can-subscribe-to-external-event-sources" title="Permanent link">&para;</a></h3>
<p>If a workflow needs to respond to some external event source (e.g. push notifications), the workflow can ask the context to listen to those events from within the <code>render</code> method.</p>
<h3 id="workflows-can-perform-asynchronous-tasks-workers">Workflows can perform asynchronous tasks (Workers)<a class="headerlink" href="#workflows-can-perform-asynchronous-tasks-workers" title="Permanent link">&para;</a></h3>
<p><code>Workers</code> are very similar in concept to child workflows. Unlike child workflows, however, workers do not have a <code>Rendering</code> type; they only exist to perform a single asynchronous task before sending zero or more output events back up the tree to their parent.</p>
<p>A workflow can ask the infrastructure to await the result of a worker by handing that worker to the context within a call to the <code>render</code> method.</p>
<h3 id="workflows-are-advanced-by-actions">Workflows are advanced by <code>Action</code>s<a class="headerlink" href="#workflows-are-advanced-by-actions" title="Permanent link">&para;</a></h3>
<p>Any time something happens that should advance a workflow – a UI event, a network response, a child&rsquo;s output event – actions are used to perform the update. For example, a workflow may respond to UI events by mapping those events into a type conforming to <code>WorkflowAction</code>. These types implement the logic to advance a workflow by:</p>
<ul>
<li>Advancing to a new state</li>
<li>(Optionally) emitting an output event up the tree.</li>
</ul>
<h3 id="workflows-can-emit-output-events-up-the-hierarchy-to-their-parent">Workflows can emit output events up the hierarchy to their parent<a class="headerlink" href="#workflows-can-emit-output-events-up-the-hierarchy-to-their-parent" title="Permanent link">&para;</a></h3>
<p>When a workflow is advanced by an action, an optional output event can be sent up the workflow hierarchy. This is the opportunity for a workflow to notify its parent that something has happened (and the parent&rsquo;s opportunity to respond to that event by dispatching its own action, continuing up the tree as long as output events are emitted).</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../overview/" title="Documentation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Documentation
              </span>
            </div>
          </a>
        
        
          <a href="../kotlin/" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Overview
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Square, Inc.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>